<!DOCTYPE html> 
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title></title>
		<script type="text/javascript" src="libs/d3.v4.js"></script>
		<script type="text/javascript" src="libs/jquery-3.2.1.js"></script>
		<link rel="stylesheet" href="main.css" />
	</head>

	<body>
		<div id="main-container">
			<div id="sidebar">
				<svg id="sidebar-canvas" width="100%" height="100%">
					<text class="" x="45" y="200">Label 1</text>
			        <text class="" x="45" y="250">Label 2</text>
			        <text class="" x="45" y="300">Label 3</text>
			        <text class="" x="45" y="350">Label 4</text>
			        <text class="" x="45" y="400">Label 5</text>
			        <text class="" x="45" y="450">Label 6</text>	
				</svg>
				<form id="country-form" onSubmit="return selectCountry()" action="">
		            <input type="text" class="headline" id="country-field" placeholder="country">
		        </form>		        
			</div>
			<div id="map-container"></div>
		</div>

		<script type="text/javascript">

			/**
			Constants
			*/						

			/**
			Global variables
			*/
			var mapCanvas;
			var selectedCountry;
			var comparisonCountry;		

			/**
			Load Data
			*/
			var foodWasteData = [{
				iso : "DK",
				valueMillions: "2343.5",
				year: 2009
			}];

			var bigMacIDX;

			d3.csv("BigMacIDX.csv", function(data){ 
				bigMacIDX = data;
				//console.log(data[0]);
			});		

			/**
			Load Resources
			*/
			d3.xml("resources/WorldMap_COUNTRYCODE.svg").mimeType("image/svg+xml").get(function(error, xml) {
			  if (error) throw error;
			  var svg = xml.documentElement;
			  svg.id = "map";
			  document.getElementById("map-container").appendChild(svg);
			  mapCanvas = d3.select("#map");
			  setup();
			});			

			function setup(){
				registerMouseEvents();
				drawMainInterface();
				$(document).ready(function() {					
					$("#country-field").focus();
				});
			}

			function sortByPosition(a, b){
			  if (a.y == b.y) return a.x - b.x;
			  return a.y - b.y;
			}

			function registerMouseEvents(){				
				mapCanvas.selectAll("g").on("mouseover", function(){
					var countryISO = this.id;					
					var country = d3.select(this);					
					var circles = country.selectAll("circle");
					circles.attr("class", "circle circle-selected circle-" + countryISO);
					console.log(countryISO);			
				}).on("mouseout", function(){
					var countryISO = this.id;					
					var country = d3.select(this);					
					var circles = country.selectAll("circle");					
					country.selectAll("circle").attr("class", "circle circle-deselected");					
				});
			}

			function selectCountry(event){
				//TODO
				var country = mapCanvas.select("#AU");
				selectedCountry = "AU";

				mapCanvas.selectAll("circle").attr("class", "circle circle-deselected");				
				var circles = country.selectAll("circle");
				circles.attr("class", "circle circle-AU circle-selected");
				// console.log(document.getElementById("country-field").value);
				return false;
			}

			function drawMainInterface(){												
				mapCanvas.selectAll("circle")
					.style("opacity", 0)
					.attr("class", "circle");
				var circles = mapCanvas.selectAll("circle");
			
				circles.transition()
					.duration(250)
					.delay(function(d,i) { return i * 0.5; })					
					.style("opacity", 1).on("end", function(d,i){
						if(i == circles.size() -1){
							circles.style("opacity","");							
						}
					});
				
				drawCurve(0,0, 100, 50);
				drawSidebar();
			}

			function drawCurve(fromX, fromY, toX, toY){

				var dataArray = [{x:fromX, y:fromY},{x:toX / 2, y:fromY + 50},{x:toX, y:toY}];				
				var group = mapCanvas.append("g").attr("class","group1");

			 	var lineGenerator = d3.line()
                         .x(function(d) { return d.x; })
                         .y(function(d) { return d.y; })
                         .curve(d3.curveBasis);

			    group.append("path")
				.style("fill","none")
				.style("stroke","#999999")
				.style("stroke-width","2px")
				.style("stroke-dasharray", [10,5])
				.attr("d",function(d,i){ return lineGenerator(dataArray); });
			}


			function drawSidebar(){				
				var sidebar=d3.select("#sidebar-canvas");
				var title = sidebar.append("text")
				.attr("class", "title")
				.attr("x", 45)
				.attr("y", 45)
				.text("I live in");
			}

		</script>
	</body>

</html>